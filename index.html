<head>
	<title>it's me, mario!</title>
	<meta charset="UTF-8">
	<link rel='icon' href='favicon.ico' type='image/x-icon'/ >
</head>
<body>
<script src="Mario.js"> </script>
<script src="Pickle_Rick.js"> </script>
<script src="Brick.js"> </script>
<script src="CoinBlock.js"> </script>
<script src="Coin.js"> </script>
<br>
<canvas id="myCanvas" width="1255" height="700" style="border:1px solid #cccccc;"></canvas>
<script type="text/javascript">

////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////Model//////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
class Model
{
	constructor()
	{
		this.scrollPos = 0;
		this.bScrollPos = 0;
		this.startPos = 550;
		this.ground = 455;

		this.mario = new Mario(this, this.startPos, this.ground);
		this.rick = new Pickle_Rick(this,2350, 0);
		this.brick1 = new Brick(this, 350, 350);
		this.brick2 = new Brick(this, 1000, 280);
		this.coinBlock1 = new CoinBlock(this, 150, 250);
		this.coinBlock2 = new CoinBlock(this, 1300, 200);

		this.sprites = [];
		this.sprites.push(this.mario);
		this.sprites.push(this.rick);
		this.sprites.push(this.brick1);
		this.sprites.push(this.brick2);
		this.sprites.push(this.coinBlock1);
		this.sprites.push(this.coinBlock2);
	}

	update()
	{
		for(let i = 0; i < this.sprites.length; i++)
		{
			let s = this.sprites[i];
			s.update();
		}
	}
}



////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////View///////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
class View
{
	constructor(model)
	{
		this.model = model;
		this.backgroundPic = new Image();
		this.backgroundPic.src = "scaledBackground.png";
		this.canvas = document.getElementById("myCanvas");
	}

	update()
	{
		//clear the screen
		let ctx = this.canvas.getContext("2d");
		ctx.clearRect(0, 0, 1255, 700);

		//draw the sky
		ctx.beginPath();
		ctx.rect(0, 0, 1500, 1000);
		ctx.fillStyle = 'rgb(55, 201, 200)';
		ctx.fill();

		//draw the background
		ctx.drawImage(this.backgroundPic, 100 - this.model.bScrollPos, -500);

		//draw the ground
		ctx.beginPath();
		ctx.rect(0, this.model.startPos, 1500, 1000);
		ctx.fillStyle = "green";
		ctx.fill();

		//draw the sprites
		for(let i = 0; i < this.model.sprites.length; i++)
		{
			this.model.sprites[i].drawMe(ctx);
		}
	}
}



////////////////////////////////////////////////////////////////////////////////
//////////////////////////////Controller////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
class Controller
{
	constructor(model, view)
	{
		this.model = model;
		this.view = view;
		this.key_right = false;
		this.key_left = false;
		this.key_space = false;
		let self = this;
		document.addEventListener('keydown', function(event) { self.keyDown(event); }, false);
		document.addEventListener('keyup', function(event) { self.keyUp(event); }, false);
	}

	keyDown(event)
	{
		if(event.keyCode == 39)
			this.key_right = true;

		else if(event.keyCode == 37)
			this.key_left = true;

		else if(event.keyCode == 32)
		if(this.model.mario.onTop == true || this.model.mario.y == this.model.ground)
			this.key_space = true;
	}

	keyUp(event)
	{
		if(event.keyCode == 39) this.key_right = false;
		else if(event.keyCode == 37) this.key_left = false;
		else if(event.keyCode == 32) this.key_space = false;
	}

	update()
	{
		this.model.mario.notePrevious();
    this.model.mario.runningLeft = false;
    this.model.mario.runningRight = false;

    if(this.key_right)//make mario run right
		{
      this.model.mario.runningRight = true;
    }

		if(this.key_left)//make Mario run left
		{
      this.model.mario.runningLeft = true;
    }

		if(this.key_space)//make mario jump
		{
      if (this.model.mario.vvel == 0)
      {
        this.model.mario.vvel = -40;
      }
		}
	}
}



////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////Game///////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
class Game
{
	constructor()
	{
		this.model = new Model();
		this.view = new View(this.model);
		this.controller = new Controller(this.model, this.view);
	}

	onTimer()
	{
		this.controller.update();
		this.model.update();
		this.view.update();
	}
}


let game = new Game();
let timer = setInterval(function() { game.onTimer(); }, 40);

</script>
</body>
